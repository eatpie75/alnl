// Generated by CoffeeScript 1.9.3
(function() {
  var Post;

  Post = (function() {
    function Post() {
      this.input_timeout = null;
      this.previous_value = '';
      this.draft_key = '';
      this.post = $('#post');
      if (window.ENTRY_ID) {
        this.draft_key = "draft/" + window.ENTRY_ID;
      } else {
        this.draft_key = 'draft';
      }
      if ($('#post').val() === '' && window.localStorage.getItem(this.draft_key)) {
        this.post.val(window.localStorage.getItem(this.draft_key));
      } else {
        window.localStorage.setItem(this.draft_key, '');
      }
      this.post.on('keydown keyup change', (function(_this) {
        return function(e) {
          $('#preview').html(md.render(_this.post.val()));
          if (_this.post.val() !== window.localStorage.getItem(_this.draft_key)) {
            return window.localStorage.setItem(_this.draft_key, _this.post.val());
          }
        };
      })(this));
      $('#submit').on('click', (function(_this) {
        return function() {
          var url;
          if (window.ENTRY_ID) {
            url = "/api/entry/" + window.ENTRY_ID;
          } else {
            url = "/api/entry";
          }
          return $.ajax({
            url: url,
            method: 'POST',
            data: {
              'content': $('#post').val()
            },
            dataType: 'json',
            success: function(data) {
              window.localStorage.removeItem(_this.draft_key);
              return window.location = data['redirect'];
            }
          });
        };
      })(this));
      this.post.change();
    }

    return Post;

  })();

  $(document).ready(function() {
    return window.post = new Post;
  });

}).call(this);
